import {
  Card,
  Heading,
  Paragraph,
  Accordion,
} from '@digdir/designsystemet-react';

import { Meta, Image } from '@components';
import { Contributors } from '@blog';
import { MenuPageLayout } from '@layouts';

<Meta
  title='Feilmeldinger i skjema'
  description='Slik forteller du brukeren at noe har gått galt eller mangler i et skjema.'
/>

export default ({ children }) => (
  <MenuPageLayout
    content={children}
    data={{
      title: 'Brukerutløste feilmeldinger i selvbetjeningsløsninger',
      date: '4. juni 2024',
    }}
  />
);

Feil som hindrer brukeren i å komme videre kan skyldes både [systemfeil](/monstre/systemvarsler) og brukerutløste feil. Denne artikkelen tar for seg brukerutløste feilmeldinger i selvbetjeningsløsninger og skjema. Hvordan kan vi unngå dem, og hvordan kan vi best mulig hjelpe brukerne å komme seg videre når en feil likevel har oppstått?

<Card
  color='third'
>
  <Card.Content
  style={{
    paddingTop: '0px',
    paddingBottom: '0px'
  }}
  >
    *Retningslinjene er utarbeidet i en tverretatlig arbeidsgruppe med deltakere fra Digdir, Nav, Skatt, Brreg, Politiet, KS DIF og Oslo kommune. Du kan påvirke arbeidet i [Github](https://github.com/digdir/designsystemet/discussions/1684) eller i [#Mønster-kanalen](https://designsystemet.slack.com/archives/C05RBGB92MC/p1712751837722749) på [Slack](https://join.slack.com/t/designsystemet/shared_invite/zt-2438eotl3-a4266Vd2IeqMWO8TBw5PrQ).

  </Card.Content>
</Card>

## Vi skiller mellom systemvarsler, myke valideringer og feilmeldinger

### Systemvarsler

Systemvarsler, eller "systemgenererte meldinger", brukes for å varsle brukeren enten om feil i systemet eller holde dem informert om viktige ting de bør få med seg. Det finnes en [egen artikkel om systemvarsler](/monstre/systemvarsler).

### Myke valideringer

Myke valideringer, eller "brukerutløste infomeldinger", bruker vi til å gi brukeren informasjon, uten å stoppe dem fra å sende inn eller gå videre til neste steg.

<Accordion
  color='neutral'
>
  <Accordion.Item>
    <Accordion.Header level={3}>Mer om myke valideringer</Accordion.Header>
    <Accordion.Content
    style={{
    paddingTop: '0px',
    paddingBottom: '0px',
    maxWidth: '780px'
  }}>
      Myke valideringer, eller "brukerutløste infomeldinger", er meldinger som ikke stopper brukeren fra å sende inn eller gå videre til neste steg i prosessen. De gir kun informasjon til brukeren. Slike meldinger kan for eksempel presenteres i en [alert](https://storybook.designsystemet.no/?path=/docs/komponenter-alert--docs#informasjon) av typen "info" eller "success". Disse meldingene oppfører seg på samme måte som feilmeldinger og blir vist etter at brukeren har oppgitt informasjon i et skjemafelt. Vi kan bruke denne typen melding når vi skal informere om konsekvenser av et valg.

Eksempler:

- Du starter en bedrift og skal registrere navnet. Du får beskjeden “Bedriftsnavnet er allerede i bruk av noen andre. Du kan bruke det men det er ikke sikkert du vil finne ledig webdomene, og du kan risikere at ditt foretak vil bli forvekslet med et annet. ”
- Du gjør et valg i skjemaet som fører til lengre behandlingstid for søknaden. Du får en infomelding om at "Ventetiden vil være 2-3 måneder lengre med alternativet du har valgt."

</Accordion.Content>

  </Accordion.Item>
</Accordion>

### Feilmeldinger

Vi bruker feilmeldinger når brukerne har gjort en feil som hindrer dem i å komme videre. Da skal vi beskrive problemet i en feilmelding og forklare hva brukerne må gjøre for å komme videre. Feilmeldingen skal være lett å se og presist formulert.

Feilmeldinger kan være knyttet til et enkelt felt eller til flere felt. Vi har også oppsummering av flere feilmeldinger som vises dersom brukeren forsøker å gå videre uten å ha fylt ut alt.

#### Feilmeldinger på enkeltfelter

Alle skjemakomponenter skal kunne ha en feilmelding som kan plasseres nært feltet som feiler.

<Image
  src='/img/errormessage-co-1.png'
  alt='Skjermbilde av skjema med en feilmelding. Brukeren har skrevet "fdgdfgfdg" inn i et felt for fødselsnummer. Feilmeldingen sier at Fødselsnummer  skal inneholde 11 siffer.'
  boxShadow={false}
/>

#### Feilmelding basert på inndata som gjelder flere felter

I dette eksempelet har vi en gruppe med felter, der brukeren ikke nødvendigvis har alle opplysningene, men må fylle ut minst ett felt.

<Image
  src='/img/errormessage-co-2.png'
  alt='Skjermbilde av skjema med en feilmelding. Brukeren har skrevet "fdgdfgfdg" inn i et felt for fødselsnummer. Feilmeldingen sier at Fødselsnummer  skal inneholde 11 siffer.'
  boxShadow={false}
/>

#### Oppsummering av flere feilmeldinger

En oppsummering kan gjelde for én eller flere feil.

Generelt anbefaler vi at hvis brukerne prøver å gå videre uten å ha fylt ut alt, eller de har gjort feil, oppsummerer like over "Neste"/"Send inn"-knappen. Vi vil vise oppsummeringen i nærheten av "Neste"-knappen for at brukerne skal forstå sammenhengen mellom feilen og hvorfor de blir hindret i å gå videre.

I noen tilfeller kan det være bedre å vise oppsummeringen i toppen:

- Hvis den tekniske løsningen laster siden på nytt når brukerne prøver å trykke Neste.
- Når brukeren har vært ute av et skjema og går inn igjen.
- Når løsningen ikke stopper deg fra å gå videre til neste side selv om du har feil på en side.

Det er altså løsningen eller tjenesten du lager, som bestemmer om du bør plassere oppsummeringen øverst på siden eller lenger nede, før knappen som tar brukerne videre. Det viktigste er at brukeren lett ser oppsummeringen.

**Pass på at**

- oppsummeringen viser alle feilmeldingene som gjelder for siden eller trinnet
- brukerne kan gå direkte til feilene de må rette og fokuset blir flyttet dit
- lenkene i oppsummeringen stemmer med feilmeldingen de lenker til
- hvis det er flere feil, så lenker du til den første feilen i rekken
- feilene forsvinner fra oppsummeringen etter hvert som brukerne fikser dem
- teksten i en oppsummerende feilmelding skal ha med nøkkelord fra ledetekstene til feltene som har feil

<Image
  src='/img/errormessage-co-3.png'
  alt='Skjermbilde av skjema med en feilmelding. Brukeren har skrevet "fdgdfgfdg" inn i et felt for fødselsnummer. Feilmeldingen sier at Fødselsnummer  skal inneholde 11 siffer.'
  boxShadow={false}
/>

## Hvordan kan vi unngå å gi feilmeldinger?

Det er best om vi klarer å hindre at det oppstår feil. Slik kan vi gjøre det:

- Gi all relevant informasjon på en tydelig måte før brukerne starter.
- Feltene må godta ulik formatering, for eksempel for datoer og telefonnummer.
- Gi brukerne mulighet til å endre svar i felter eller gå tilbake.
- La brukerne ta en pause i utfyllingen eller avbryte den.
- Bruk ledetekster og beskrivelser for å hjelpe brukerne på vei.
- Suppler med hjelpetekster om nødvendig.
- Legg inn en bestemt rekkefølge på svaralternativene, for å hindre at brukeren tar valg som fører til feil.
- Hvis vi har tegnbegrensing i et felt, viser vi en teller og en beskrivelse under ledeteksten om maks. antall tegn.

## Slik skriver du en god feilmelding

Den viktigste jobben til teksten i en feilmelding er å hjelpe brukerne videre:

- Skriv vennlig, klart og tydelig og hold feilmeldingen kort.
- Vær konkret. Når du skriver “Feltet er ikke fylt ut korrekt”, får ikke brukeren noen forklaring på hva som er feil.
- Gi spesifikk informasjon om hva som er problemet og gjenta nøkkelord fra ledeteksten.

Eksempler på forklarende feilmeldinger:

- “Postnummeret må ha 4 siffer”
- "Fødselsnummeret må ha 11 siffer"
- “Du må velge minst ett av leveringsalternativene”
- “Kryss av i ruten for å bekrefte at navnet er riktig, før du sender inn skjemaet”

## Når skal vi vise en feilmelding?

Vi kan presentere feilmeldinger for brukerne når brukerne forlater feltet eller når de velger "Gå videre" eller "Send inn". Vi unngår å vise feilmeldinger mens brukeren fyller ut feltet.

Når brukerne forlater et felt, viser vi feilmeldinger kun når vi kan se at brukeren ikke har fylt ut det vi forventer. Et eksempel kan være at de har lagt inn bokstaver i et fødselsnummer, eller at en e-postadresse mangler krøllalfa (@).

Hvis det er felter som må fylles ut, eller det er feil i flere felter, er det best å vise feilmeldingen når brukeren selv er klar for å gå videre. Det er spesielt viktig når når brukere benytter tastaturet til å navigere i løsningen. Da virker det forstyrrende hvis det dukker opp feilmeldinger på felter brukeren ikke har fylt ut enda.

Vi koder feilmeldinger som skal vises når brukeren forlater feltet på en slik måte at vi vet om brukeren har skrevet noe i feltet før vi viser feilmeldingen. Det tryggeste er å vise feilmeldingen når brukeren selv er klar til å gå videre.

Brukerne bør ikke få feilmelding for et obligatorisk felt før de prøver å gå til neste side eller sende inn skjemaet. Da må vi vise tydelig at det er et felt som ikke er fylt ut. Her kan du lese mer om hvordan du markerer obligatoriske og valgfrie skjemafelt.

### Ikke deaktiver submit-knappen

Vi bruker ikke deaktivert "Gå videre"/"Send inn"-knapp til å validere skjema. Noen brukere forstår ikke hvorfor knappen er deaktivert og kan bli forvirret. Brukere med nedsatt syn kan slite med å finne knappen og tro at skjemaet har tekniske problemer. Hvis brukeren prøver å velge knappen mens det er feil i skjemaet, kan vi heller vise en oppsummerende feilmelding over "Gå videre"/"Send inn"-knappen.

## Utseendet på feilmeldinger

Når et skjemafelt feiler er det viktig å fremheve feltet slik at det er lett for våre brukere å se hvor de har gjenstående oppgaver.

<Image
  src='/img/valideringsvisning.png'
  alt='2 skjemafelter, det første er i en vanlig tilstand og det andre er i en tilstand som viser feil på informasjonen som er fylt ut. Ved feltet som feiler blir de visuelle elementene som skiller det fra et vanlig felt fremhevet: Det er tykkere kant rundt feltet, det er farget rødt og det er en rød tekst med et tilhørende fareikon som beskriver feilen på feltet.'
  boxShadow={false}
/>

Vi ønsker å fremheve felter som har valideringsfeil. For å få dette til bruker vi en kombinasjon av virkemidler.

**Visuelle endringer** <br />
Legg selve feilmeldingsteksten nært feltet det gjelder. Vi bruker en rød varseltrekant med utropstegn som vises før teksten. Vi anbefaler å ha med et symbol fordi det kan være fint med en visuell indikator i tillegg til tekst. For de komponentene hvor det er mulig kan man også endre tykkelsen på selve komponenten som vist i eksempelet over.

**Fargevalg** <br />
Feltet og selve feilmeldingen farges rødt. Dette er et godt etablert mønster som hjelper med å skille feltet fra andre felter. Husk at feltet må ha 3:1 kontrast til bakgrunnsfargen. Om du også bruker rød tekst til feilmeldingen må den minst være 4.5:1. [Tilsynet for universell utforming av ikt's artikkel om kontraster](https://www.uutilsynet.no/veiledning/kontrast/48)

**Plassering av feilmelding** <br />
Vi viser feilmeldingen under feltet med feil. Det kan være uheldig å plassere ny informasjon tidligere i flyten, og alle vil kanskje ikke få det med seg. Derfor bør feilmeldingen komme rett etterpå. Dette er også det vanligste mønsteret.

<Card
  color='first'
>
  <Card.Content
  style={{
    paddingTop: '0px',
    paddingBottom: '0px'
  }}
  >
    NB: Vi ønsker mer innsikt rundt plasseringen, og har en [pågående diskusjon om dette på Git](https://github.com/digdir/designsystemet/discussions/1684#discussioncomment-9339006).

  </Card.Content>
</Card>

## Validering og kryssvalidering

Noen ganger vil ett eller flere felter og hvilke valg som tas i dem påvirke hverandre og resultere i feil som ikke vil være opplagt ut fra de enkelte feltene alene. For eksempel kan valg verdi i en radiogruppe gjøre et frivillig felt senere i utfyllingen påkrevd, eller et valg et sted kan gjøre at valg i et annet felt må være innenfor en viss verdi. Dette kalles kryssvalidering.

For å gjøre det så tydelig som mulig for brukeren at et eller flere felter påvirker hverandre så kan det være lurt å informere om det med dynamisk hjelpetekst når et slikt valg er tatt.

Så hva gjør vi når felter som grunnet slik kryssvalidering, har feil ikke står i nærheten av hverandre?

- Merk alle feltene med feilmarkering og feilmelding.
- Gjør det tydelig at det er en feil som skyldes kryssvalidering.
- Gjengi verdiene fra andre felter i hver feilmelding.
- Forklar hvilke forhold utløste feilen.
- Gi veiledning i hvordan en kan rette feilen.

## Feilmeldinger og tilgjengelighet

Det er flere WCAG-kriterier som er relevante når vi jobber med feilmeldinger. Vi har tatt hensyn til disse i arbeidet med mønsteret. Om du er interessert i å lese mer om disse, kan du lese tolkningene av WCAG-kravene hos Tilsynet for universell utforming av IKT.

**Relevante WCAG-krav:**

- [3.3.1 Identifikasjon av feil](https://www.uutilsynet.no/wcag-standarden/331-identifikasjon-av-feil-niva/116)
- [3.3.3 Forslag ved feil](https://www.uutilsynet.no/wcag-standarden/333-forslag-ved-feil-niva-aa/118)
- [1.4.3 Kontrast (minimum)](https://www.uutilsynet.no/wcag-standarden/143-kontrast-minimum-niva-aa/95)
- [1.4.11 kontrast for ikke-tekstlig innhold](https://www.uutilsynet.no/wcag-standarden/1411-kontrast-ikke-tekstlig-innhold-niva-aa/145)

## HTML og Aria

For at alle brukere skal kunne oppfatte feilmeldinger er det viktig at forholdet mellom feilmelding og feltene de hører til er tydelig, også for dem som får tilgang til innhold med ulike hjelpemidler.

Vi kan bruke disse aria-attributtene og rollene:

- Vi setter aria-invalid=”true” på felt med en feil, for å si fra om at det er en feil der.
- Vi bruker aria-errormessage=”feilmeldingID” på felt med feil for å fortelle hvilket html-element som gir forklarende tekst til feilen. “feilmeldingID” står for den ID-en tilhører elementet med feilmeldingen.

### Bruke automatiske beskjeder

Vi kan også utløse automatiske beskjeder når vi vil at brukeren skal få opplest viktig informasjon så snart som mulig. Det kan for eksempel være når det blir en stor visuell endring eller nytt innhold.

For feilmeldinger som dukker opp dynamisk må vi bruke aria-live for at meldingen skal bli lest opp av skjermlesere. Vær oppmerksom på om du setter aria-live til å være assertive eller polite. I de aller fleste tilfeller vil det være best å sette polite, for da venter den til skjermleseren er ferdig med å lese opp.

## Kilder

- [Help users to Recover from validation errors, GovUK](https://design-system.service.gov.uk/patterns/validation/)
- [Designing Better Error Messages UX, Smashing Magazine/Vitaly Friedman](https://www.smashingmagazine.com/2022/08/error-messages-ux-design)
- [Formidle feil i skjema, UU-tilsynet](https://www.uutilsynet.no/veiledning/skjema/38#formidle_feil_i_skjema)
- [Use forgiving formatting, NN Group](https://www.nngroup.com/articles/slips/)
- [Error Messages Guidelines, NN Group](https://www.nngroup.com/articles/error-message-guidelines/)
- [How to Report Errors in Forms, NN Group](https://www.nngroup.com/articles/errors-forms-design-guidelines/)
- [Suksesskriterium 3.3.1 Identifikasjon av feil](https://www.w3.org/Translations/WCAG21-no/#error-identification)
- [Suksesskriterium 3.3.3 Forslag ved feil](https://www.w3.org/Translations/WCAG21-no/#error-suggestion)
- [Skjemavalidering, Aksel](https://aksel.nav.no/god-praksis/artikler/skjemavalidering)
- [Fejlmeddelelser, Fælles designsystem](https://designsystem.dk/komponenter/fejlmeddelelser/)

<br />
<br />
<br />
---

<Contributors
  authors={[
    'Roy Halvor Frimanslund',
    'Astrid Eline Øksnes',
    'Bernard Tommerbakke',
    'Kari Breidal',
    'Lasse Febakke Straum',
    'Marianne Røsvik',
    'Marianne Nordberg',
    'Camilla Orten',
    'Gørild Døhl',
  ]}
/>
<br />
<br />
<br />
---
